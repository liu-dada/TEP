% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wang_allison.R
\name{wang_allison_helpers}
\alias{wang_allison_helpers}
\alias{wa_percentile_age}
\alias{wa_counts}
\alias{wang_allison_test}
\title{Wang & Allison (2004) Helpers for Survival Percentile Analysis}
\usage{
wa_percentile_age(df, p = 0.9, groups = NULL)

wa_counts(df, t_star, ctrl, treat)

wang_allison_test(
  df,
  ctrl,
  treat,
  p = 0.9,
  threshold_from = c("pooled", "control")
)
}
\arguments{
\item{df}{A data frame containing at least columns \code{age}, \code{dead}, and \code{group}.}

\item{p}{Numeric between 0 and 1. The survival percentile (default 0.9 for the 90th percentile).}

\item{groups}{Optional character vector. Groups to include when calculating the percentile in \code{wa_percentile_age()}.}

\item{t_star}{Numeric. Threshold age corresponding to the percentile (output from \code{wa_percentile_age()}).}

\item{ctrl}{Character. Name of the control group.}

\item{treat}{Character. Name of the treatment group.}

\item{threshold_from}{Character. How to compute the threshold age in \code{wang_allison_test()}. Either \code{"pooled"} (default) or \code{"control"}.}
}
\value{
\itemize{
\item \code{wa_percentile_age()} returns a numeric value of the age at the specified percentile, or \code{NA_real_} if not computable.
\item \code{wa_counts()} returns a 2x2 table of counts, rows are groups, columns are \code{FALSE} (below threshold) and \code{TRUE} (above threshold).
\item \code{wang_allison_test()} returns a list with elements:
\itemize{
\item \code{t_star}: threshold age used,
\item \code{table}: the 2x2 counts table,
\item \code{fisher}: result of \code{fisher.test()} for the two groups.
}
}
}
\description{
These functions implement the Wang & Allison (2004) approach for comparing survival
between two groups at a specified survival percentile:
}
\details{
\itemize{
\item \code{wa_percentile_age()} computes the age (time) corresponding to a given survival percentile.
\item \code{wa_counts()} counts the number of individuals above and below the threshold in each group.
\item \code{wang_allison_test()} performs the Fisher exact test at the threshold age for two groups.
}
}
\examples{
library(survival)
set.seed(123)
dat <- data.frame(
  age = runif(200, 1, 1500),
  dead = rbinom(200, 1, 0.4),
  group = sample(c("Control", "Treatment"), 200, replace = TRUE)
)

# Compute 90th percentile age
t_star <- wa_percentile_age(dat, p = 0.9)

# Count above/below threshold
wa_counts(dat, t_star, ctrl = "Control", treat = "Treatment")

# Fisher exact test at 90th percentile
wang_allison_test(dat, ctrl = "Control", treat = "Treatment", p = 0.9)

}
