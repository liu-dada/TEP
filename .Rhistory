usethis::use_mit_license("QLiu")
usethis::use_readme_rmd()
#import multiple packages
pkgs <- c("survminer", "ggeasy", "bshazard", "plyr","dplyr","survival","ggplot2","tidyverse","tidyr","readxl","patchwork")
purrr::walk(pkgs, usethis::use_package)
# Make multiple jittered copies of each subject's record
augment_surv_data <- function(df, reps = 10, age_sd = NULL) {
# df must have columns: age, dead, group (and any others you like)
# Choose a default jitter scale based on typical spacing of event times
if (is.null(age_sd)) {
uniq_ev <- sort(unique(df$age[df$dead == 1]))
if (length(uniq_ev) >= 2) {
age_sd <- 0.1 * stats::median(diff(uniq_ev))  # 10% of median spacing
} else {
age_sd <- 0.01 * max(df$age, na.rm = TRUE)    # fallback: 1% of max age
}
}
# Replicate rows
idx <- rep(seq_len(nrow(df)), each = reps)
out <- df[idx, , drop = FALSE]
# Add Gaussian noise to ages (x_i), leave dead and group untouched
out$age <- out$age + stats::rnorm(nrow(out), mean = 0, sd = age_sd)
# Avoid non-positive ages
min_pos <- min(df$age[df$age > 0], na.rm = TRUE)
out$age[out$age <= 0] <- min_pos
out
}
document()
devtools::document()
getwd()
load_all()
devtools::load_all()
library(TEP)
devtools::document()
devtools::document()
library(TEP)
devtools::load_all()
library(TEP)
devtools::document()
devtools::document()
devtools::load_all()
rm(list = ls())
devtools::load_all()
#test augment function
#---------------------------
#Level 1: Interactive test
df <- data.frame(
age   = c(5, 10, 15),
dead  = c(1, 0, 1),
group = c("A", "A", "B")
)
set.seed(123)
out <- augment_surv_data(df, reps = 5)
nrow(out)              # should be 15 (3 Ã— 5)
head(out)
summary(out$age)
all(out$age > 0)
#Level 2: Edge-case tests
#1 event
df1 <- data.frame(
age = c(10, 10, 10),
dead = c(1, 0, 0),
group = c("A", "A", "B")
)
augment_surv_data(df1)
#very small age
df2 <- data.frame(
age = c(0.5, 1, 1.5),
dead = c(1, 1, 0),
group = c("A", "B", "A")
)
out2 <- augment_surv_data(df2, reps = 3)
min(out2$age) > 0
#---------------------------
#Level 3: Proper unit tests
usethis::use_testthat()
usethis::use_test("augment_surv_data")
test_that("multiplication works", {
expect_equal(2 * 2, 4)
})
devtools::test()
devtools::check()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
library(TEP)
set.seed(123)
dat <- data.frame(
age = runif(200, 1, 1500),
dead = rbinom(200, 1, 0.4),
group = sample(c("Control", "Treatment"), 200, replace = TRUE)
)
hr <- bshr(
data = dat,
contr = "Control",
var = "Treatment",
n_boot = 100
)
document()
devtools::document()
devtools::document()
hr <- bshr(
data = dat,
contr = "Control",
var = "Treatment",
n_boot = 100
)
hrplot(hr, var = "Treatment")
devtools::build_readme()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
usethis::use_data_raw(name = "example_data")
## code to prepare `example_data` dataset goes here
library(readxl)
?read_excel
example_data <- read_excel("C:/Users/churc/Downloads/Sample file small.xlsx",sheet = 1)
View(example_data)
usethis::use_data(example_data, overwrite = TRUE)
library(TEP)
data("example_data")
View(example_data)
library(TEP)
remotes::install_github("liu-dada/TEP")
library(TEP)
data(example_data)
make_km_band(example_data)
make_km_band(data = example_data)
?make_km_band
?safe_bshazard
?augment_surv_data
aug <- augment_surv_data(example_data)
